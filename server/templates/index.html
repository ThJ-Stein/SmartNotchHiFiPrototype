<html>
<head>
<meta charset="UTF-8"> 
<title>SmartNotch Prototype</title>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<style>
#Container {	
	width: 100%;
	height:100%;
	position: relative;
	background-image: url('../images/straat.svg');
	background-repeat: no-repeat;
	background-size: cover;
	background-position: center;
	background-color: #f3f3f3;
}
#Car {
	width: 12%;
	height: 12%;
	top: 15%;
	left: 41.5%;
	position: absolute;	
	background-image: url('../images/car front.svg');
	background-repeat: no-repeat;
	background-size: contain;
	background-position: center;
	display: none;
}
#Pedestrian1 {
	width: 10%;
	height: 10%;
	top: 65%;
	left: 25%;
	position: absolute;
	background-image: url('../images/pedestrian male.svg');
	background-repeat: no-repeat;
	background-size: contain;
	background-position: center;
	display: none;
}
#Pedestrian2 {
	width:  10%;
	height: 10%;
	top:    67%;
	left:   65%;
	position: absolute;
	background-image: url('../images/pedestrian female.svg');
	background-repeat: no-repeat;
	background-size: contain;
	background-position: center;
	display: none;
}
@keyframes SwipeRight {
	from {left: 0px; opacity: 1;}
	to {left: 1000px; opacity: 0;}
}

.SwipeRightClass {
	animation-name: SwipeRight;
	animation-duration: .5s;
}

@keyframes SwipeLeft {
	from {left: 0px; opacity: 1;}
	to {left: -1000px; opacity: 0;}
}

.SwipeLeftClass {
	animation-name: SwipeLeft;
	animation-duration: .5s;
}

@keyframes Enter {
	from {top: 200px; opacity: 0;}
	to {top: 0px; opacity: 1;}
}

.EnterClass {
	animation-name: Enter;
	animation-duration: .5s;
}

#SwipeModal {
	position: absolute;
	width: 100%;
	height: 100%;
	animation-fill-mode: forwards;
}

#SceneModal {
	position: relative;
	border-style: outset;
	border-radius: 15px;
	box-shadow: 10px 10px 5px gray;
	width: 75%;
	margin: auto;
	overflow: hidden;
}

#swipePrompt {
	display: none;
	position: absolute;

	border-style: solid;
	border-radius: 15px;
	box-shadow: 10px 10px 5px gray;
	background-color: white;

	top: 200px;

	left: 50%;
	transform: translate(-50%, 0);

	margin-top: 40px;
	margin-bottom: -15px;
	z-index: 2;
	text-align: center;
	width: 40%;
	overflow: hidden;
}

#swipePrompt table {
	position: relative;
	left: 50%;
	transform: translate(-50.5%, 2%);
	width: 100%;
	height: 150px;
}


#swipePrompt button {
    border: none;
    color: white;
      text-align: center;
      text-decoration: none;
    display: inline-block;
    font-size: 30px;
    cursor: pointer;
	width: 110%;
	height: 150px;
}

</style>
<script>
function swipeLeft() {
	$("#SwipeModal").removeClass("SwipeLeftClass SwipeRightClass EnterClass")
		.addClass("SwipeLeftClass");
	hidePrompt();
	reset();
	data.yesorno = "no";
	sendData(data);
//TODO: Async GET Request
}

function swipeRight() {
	$("#SwipeModal").removeClass("SwipeLeftClass SwipeRightClass EnterClass")
		.addClass("SwipeRightClass");
	hidePrompt();
	reset();
	data.yesorno = "yes";
	sendData(data);
//TODO: Async GET Request
}

function enter() {
	$("#SwipeModal").removeClass("SwipeLeftClass SwipeRightClass EnterClass")
		.addClass("EnterClass");
}

function sendData(myData) {
	$.ajax({
		url: "/api",
		type: "POST",
		data: JSON.stringify(myData),
		contentType: 'application/json; charset=utf-8',
		dataType: 'json'
	});
}
</script>
</head>
<body>

<div id="swipePrompt">
	<h3>Is it safe to cross?</h3> <br />
	<table>
	<tr>
	<th>
	<button style="background-color: red;" id="swipeLeftButton" onclick="swipeLeft()">No</button>
	</th>
	<th>
	<button style="background-color: green;" id="swipeRightButton" onclick="swipeRight()">Yes</button>
	</th>
	</tr>
	</table>
</div>

<div id="SwipeModal">
<div id="SceneModal">
<div id="Container">
	<div id="Car"></div>
	<div id="Pedestrian1"></div>
	<div id="Pedestrian2"></div>
</div>
</div>
</div>
<script>
$( document ).ready(function() {
  enter();
  var options = [scenarioOne, scenarioTwo]
  var modes = ["", "nozc"];

  data = {};
  data.option = options[Math.floor(Math.random()*options.length)].name;
  data.mode = modes[Math.floor(Math.random()*modes.length)];

//TODO: Asynchronous GET Request to REST API.
  scenarioOne();
  });
 var car = $("#Car");
 var carElem = document.getElementById("Car");
 var pedestrianM = $("#Pedestrian1");
 var pedestrianMElem = document.getElementById("Pedestrian1");
 var pedestrianF = $("#Pedestrian2");
 var pedestrianFElem = document.getElementById("Pedestrian2");
 var carImages = {
  left: "url('../images/car front ready for pedestrian from the left.svg')", 
  right: "url('../images/car front ready for pedestrian from the right.svg')", 
  mid: "url('../images/car front ready for pedestrian from the front.svg')",
  leftright: "url('../images/car front ready for pedestrian from both sides.svg')", 
  normal: "url('../images/car front.svg')",
  countdown5left: "url('../images/car inpatient 5 left.svg')",
  countdown5right: "url('../images/car inpatient 5 right.svg')",
  countdown5leftright: "url('../images/car inpatient 5 both sides.svg')",
  countdown5mid: "url('../images/car inpatient 5 forward.svg')",
  countdown4left: "url('../images/car inpatient 4 left.svg')",
  countdown4right: "url('../images/car inpatient 4 right.svg')",
  countdown4leftright: "url('../images/car inpatient 4 both sides.svg')",
  countdown4mid: "url('../images/car inpatient 4 forward.svg')",
  countdown3left: "url('../images/car inpatient 3 left.svg')",
  countdown3right: "url('../images/car inpatient 3 right.svg')",
  countdown3leftright: "url('../images/car inpatient 3 both sides.svg')",
  countdown3mid: "url('../images/car inpatient 3 forward.svg')",
  countdown2left: "url('../images/car inpatient 2 left.svg')",
  countdown2right: "url('../images/car inpatient 2 right.svg')",
  countdown2leftright: "url('../images/car inpatient 2 both sides.svg')",
  countdown2mid: "url('../images/car inpatient 2 forward.svg')",
  countdown1left: "url('../images/car inpatient 1 left.svg')",
  countdown1right: "url('../images/car inpatient 1 right.svg')",
  countdown1leftright: "url('../images/car inpatient 1 both sides.svg')",
  countdown1mid: "url('../images/car inpatient 1 forward.svg')",
  carno: "url('../images/car done waiting.svg')",
  zleft: "url('../images/car pedestrian left(no zc).svg')", 
  zright: "url('../images/car pedestrian right(no zc).svg')", 
  zmid: "url('../images/car pedestrian front(no zc).svg')",
  zleftright: "url('../images/car pedestrian both(no zc).svg')", 
  zcountdown5left: "url('../images/car inpatient 5 left(no zc).svg')",
  zcountdown5right: "url('../images/car inpatient 5 right(no zc).svg')",
  zcountdown5leftright: "url('../images/car inpatient 5 both sides(no zc).svg')",
  zcountdown5mid: "url('../images/car inpatient 5 forward(no zc).svg')",
  zcountdown4left: "url('../images/car inpatient 4 left(no zc).svg')",
  zcountdown4right: "url('../images/car inpatient 4 right(no zc).svg')",
  zcountdown4leftright: "url('../images/car inpatient 4 both sides(no zc).svg')",
  zcountdown4mid: "url('../images/car inpatient 4 forward(no zc).svg')",
  zcountdown3left: "url('../images/car inpatient 3 left(no zc).svg')",
  zcountdown3right: "url('../images/car inpatient 3 right(no zc).svg')",
  zcountdown3leftright: "url('../images/car inpatient 3 both sides(no zc).svg')",
  zcountdown3mid: "url('../images/car inpatient 3 forward(no zc).svg')",
  zcountdown2left: "url('../images/car inpatient 2 left(no zc).svg')",
  zcountdown2right: "url('../images/car inpatient 2 right(no zc).svg')",
  zcountdown2leftright: "url('../images/car inpatient 2 both sides(no zc).svg')",
  zcountdown2mid: "url('../images/car inpatient 2 forward(no zc).svg')",
  zcountdown1left: "url('../images/car inpatient 1 left(no zc).svg')",
  zcountdown1right: "url('../images/car inpatient 1 right(no zc).svg')",
  zcountdown1leftright: "url('../images/car inpatient 1 both sides(no zc).svg')",
  zcountdown1mid: "url('../images/car inpatient 1 forward(no zc).svg')"};
  
 function carApproach(callbacks, mode) {
  carElem.style.display = "inline";
  console.log(callbacks);
  car.animate({width: "30%", height: "30%", top: "50%", left: "30%"}, 4000, 
   function(){
    console.log(callbacks);
    callbacks.forEach( 
    function(callback) {
     callback(mode); });});
}
 function carChangeLeft(mode) {
  if (mode === "nozc") {
  carElem.style.backgroundImage = carImages.zleft;
 } else {
   carElem.style.backgroundImage = carImages.left;
 }
}
 function carChangeMid(mode) {
  if (mode === "nozc") {
  carElem.style.backgroundImage = carImages.zmid;
 } else {
   carElem.style.backgroundImage = carImages.mid;
 }
}
 function carChangeRight(mode) {
  if (mode === "nozc") {
  carElem.style.backgroundImage = carImages.zright;
 } else {
   carElem.style.backgroundImage = carImages.right;
 }
}
 function carChangeBoth(mode) {  
  if (mode === "nozc") {
  carElem.style.backgroundImage = carImages.zleftright;
 } else {
   carElem.style.backgroundImage = carImages.leftright;
 }
}
 function carCountdown(side, mode, number){
if (side === "left") { if (number === 5) {  if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown5left;
  } else {
   carElem.style.backgroundImage = carImages.countdown5left;
  } }
 if (number === 4) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown4left;
  } else {
   carElem.style.backgroundImage = carImages.countdown4left;
  } }
 if (number === 3) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown3left;
  } else {
   carElem.style.backgroundImage = carImages.countdown3left;
  } }
 if (number === 2) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown2left;
  } else {
   carElem.style.backgroundImage = carImages.countdown2left;
  } }
 if (number === 1) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown1left;
  } else {
   carElem.style.backgroundImage = carImages.countdown1left;
  } } }
if (side === "right") { if (number === 5) {  if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown5right;
  } else {
   carElem.style.backgroundImage = carImages.countdown5right;
  } }
 if (number === 4) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown4right;
  } else {
   carElem.style.backgroundImage = carImages.countdown4right;
  } }
 if (number === 3) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown3right
  } else {
   carElem.style.backgroundImage = carImages.countdown3right;
  } }
 if (number === 2) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown2right;
  } else {
   carElem.style.backgroundImage = carImages.countdown2right;
  } }
 if (number === 1) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown1right;
  } else {
   carElem.style.backgroundImage = carImages.countdown1right;
  } } }
if (side === "both") { if (number === 5) {  if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown5leftright;
  } else {
   carElem.style.backgroundImage = carImages.countdown5leftright;
  } }
 if (number === 4) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown4leftright;
  } else {
   carElem.style.backgroundImage = carImages.countdown4leftright;
  } }
 if (number === 3) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown3leftright;
  } else {
   carElem.style.backgroundImage = carImages.countdown3leftright;
  } }
 if (number === 2) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown2leftright;
  } else {
   carElem.style.backgroundImage = carImages.countdown2leftright;
  } }
 if (number === 1) { if (mode === "nozc") {
   carElem.style.backgroundImage = carImages.zcountdown1leftright;
  } else {
   carElem.style.backgroundImage = carImages.countdown1leftright;
  } } }
}

 function carChangeNO() {
  carElem.style.backgroundImage = carImages.carno;
}
 function carChangeNormal() {
  carElem.style.backgroundImage = carImages.normal;
}
 function carWait(side, mode) {
 car
  .animate({opacity: "0.99"},5000, function(){carCountDownAll(side, mode);})
}
 function carCountDownAll(side, mode){
  carCountdown(side, mode, 5);
  car
  .animate({opacity: "1"}, 1000, function() {carCountdown(side, mode, 4);})
  .animate({opacity: "0.99"}, 1000, function() {carCountdown(side, mode, 3);})
  .animate({opacity: "1"}, 1000, function() {carCountdown(side, mode, 2);})
  .animate({opacity: "0.99"}, 1000,  function() {carCountdown(side, mode, 1);})
  .animate({opacity: "1"}, 1000, carChangeNO)
  .animate({opacity: "0.99"}, 2000, carChangeNormal)
  .animate({top: "200%", left: "20%"}, 3000);
}
 function showPedestrianM() {
  pedestrianMElem.style.display = "inline";
}
 function showPedestrianF() {
  pedestrianFElem.style.display = "inline";
}
 function userQuery() {
  showPrompt();
}
/**
 function scenarioOne(mode) {
  showPedestrianM();
  carApproach(scenarioOneDelayOne, mode);
}
 function scenarioOneDelayOne(mode) {
  carChangeLeft(mode);
  car
   .animate({opacity: "0.99"} ,1500, function(){carChangeMid(mode);})
   .animate({opacity: "1"},1000, function(){carChangeRight(mode); carCountDownAll("right", mode);});
  pedestrianM.animate({left: "60%"}, 4000);
}
 function scenarioTwo(mode) {
  showPedestrianM();
  showPedestrianF();
  carApproach([carChangeBoth,userQuery], mode);
}
 function scenarioTwoDelayOne(mode) {
  carChangeBoth(mode);
  pedestrianM.animate({left: "60%"},4000);
  pedestrianF.animate({left: "25%"},3000);
  car
   .animate({opacity: "0.99"},1500, function(){carChangeMid(mode);})
   .animate({opacity: "1"},1000, function(){carChangeBoth(mode);})
   .animate({opacity: "0.99"}, 1, function(){carCountDownAll("both", mode);});
}
 function scenarioThree(mode) {
  showPedestrianM();
  carApproach(scenarioThreeDelayOne, mode);
}
 function scenarioThreeDelayOne(mode) {
  carChangeLeft(mode);
  carWait(carCountDownAll, mode);
}*/

 function scenarioOne(mode) {
  showPedestrianM();
  carApproach([carChangeLeft,userQuery],mode);
}

 function scenarioTwo(mode) {
 showPedestrianM(); showPedestrianF();
 carApproach([carChangeBoth, userQuery],mode);
}

 function reset() {
  carElem.style.backgroundImage = carImages.normal;
  carElem.style.width = "12%";
  carElem.style.height = "12%";
  carElem.style.top = "15%";
  carElem.style.left = "41.5%";
  carElem.style.display = "none";

  pedestrianMElem.style.width = "10%";
  pedestrianMElem.style.height = "10%";
  pedestrianMElem.style.top = "65%";
  pedestrianMElem.style.left = "25%";
  pedestrianMElem.style.display = "none";
  
  pedestrianFElem.style.width = "10%";
  pedestrianFElem.style.height = "10%";
  pedestrianFElem.style.top = "67%";
  pedestrianFElem.style.left = "65%";
  pedestrianFElem.style.display = "none";
}

function showPrompt() {
	$("#swipePrompt").fadeIn();
}

function hidePrompt() {
	$("#swipePrompt").fadeOut();
}
</script>
</body>
</html>
